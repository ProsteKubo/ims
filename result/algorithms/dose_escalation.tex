% Pseudocode for dose escalation logic
% Used in Chapter 3 and 4

\begin{algorithm}[H]
\caption{Dose Escalation Decision Logic}
\begin{algorithmic}[1]
\Require Current state: $C_e(t)$, $Tol(t)$, petri\_state
\Ensure Dose decision and state updates
\State $E \gets$ CalculateEffect($C_e(t)$, $Tol(t)$)
\State \Comment{Update pain level based on effect}
\If{$E < \theta_{pain,low}$} \Comment{e.g., 40\%}
    \State pain\_level $\gets$ min(pain\_level + 1, 3)
\ElsIf{$E > \theta_{pain,high}$} \Comment{e.g., 60\%}
    \State pain\_level $\gets$ max(pain\_level - 1, 0)
\EndIf
\State \Comment{Update motivation (accumulates with pain)}
\State motivation $\gets$ motivation + $\lambda_{pain} \cdot$ pain\_level $\cdot \Delta t$
\State \Comment{Update relief state}
\If{$E > \theta_{relief}$} \Comment{e.g., 55\%}
    \State relief\_state $\gets$ true
\Else
    \State relief\_state $\gets$ false
\EndIf
\State \Comment{Dose escalation decision}
\If{pain\_level $\geq 2$ AND motivation $> \theta_{motiv}$ AND $(t - t_{last\_dose}) > t_{min\_interval}$}
    \State \textbf{INCREASE\_DOSE:}
    \State \quad $f_{esc} \gets 0.10 + 0.15 \cdot Tol(t)$ \Comment{Tolerance-dependent escalation}
    \State \quad $D_{new} \gets D_{current} \cdot (1 + f_{esc})$
    \State \quad $A(t) \gets A(t) + D_{new}$ \Comment{Impulse to absorption compartment}
    \State \quad motivation $\gets$ motivation - 2.0 \Comment{Reset urgency}
    \State \quad Record dose event in history
    \State \quad $D_{current} \gets D_{new}$
    \State \quad $t_{last\_dose} \gets t$
\ElsIf{relief\_state AND $E > \theta_{relief}$}
    \State \textbf{MAINTAIN\_DOSE:}
    \State \quad $A(t) \gets A(t) + D_{current}$ \Comment{No escalation}
    \State \quad motivation $\gets$ motivation - 1.0
    \State \quad Record dose event in history
    \State \quad $t_{last\_dose} \gets t$
\Else
    \State \textbf{NO\_ACTION:} \Comment{Wait for next assessment}
\EndIf
\State \Return dose\_decision
\end{algorithmic}
\end{algorithm}
